<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive CV of Trabelsi Houssine, expert in Injection Molding and Lean Manufacturing">
    <meta property="og:title" content="Trabelsi Houssine - Interactive CV">
    <meta property="og:description" content="Explore the professional CV of Trabelsi Houssine, specializing in automotive parts production and Lean Manufacturing.">
    <meta property="og:keywords" content="Trabelsi Houssine, CV, resume, Injection Molding, Lean Manufacturing, automotive parts, WKW Tunisia">
    <meta property="og:image" content="https://i.ibb.co/tgnKQzc/20230728-121604.png">
    <meta name="author" content="Trabelsi Houssine">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Trabelsi Houssine",
      "jobTitle": "Technician",
      "birthDate": "1990-09-11",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Bizerte",
        "addressCountry": "Tunisia"
      },
      "email": "houssinetrabelsi6@gmail.com",
      "telephone": "+21622310333",
      "url": "https://www.linkedin.com/in/trabelsi-houssine-355332102"
    }
    </script>
    <title>Trabelsi Houssine - Interactive CV</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" as="style">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer></script>
    <style>
        :root {
            --primary-color: #1e3a8a;
            --accent-color: #f97316;
            --text-color: #1f2937;
            --bg-color: #f8fafc;
            --sidebar-bg: #1e293b;
            --hover-color: #fb923c;
            --gradient: linear-gradient(135deg, #f97316, #f59e0b);
            --gradient-anim: linear-gradient(135deg, #f97316 0%, #f59e0b 50%, #f97316 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            background: var(--bg-color);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
            line-height: 1.6;
        }

        body[lang="ar"] {
            direction: rtl;
            font-family: 'Poppins', 'Noto Sans Arabic', sans-serif;
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            color: #fff;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 2rem;
            transition: transform 0.4s ease;
            z-index: 1000;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
        }

        .sidebar.closed {
            transform: translateX(-100%);
        }

        .sidebar-toggle {
            background: var(--accent-color);
            color: #fff;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: var(--hover-color);
            transform: scale(1.1);
        }

        .sidebar-toggle:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        .sidebar-section h3 {
            font-size: 1.3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        .sidebar-section a, .sidebar-section button {
            display: block;
            padding: 0.8rem;
            background: #334155;
            color: #fff;
            text-decoration: none;
            border-radius: 6px;
            margin-bottom: 0.6rem;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .sidebar-section a:hover, .sidebar-section button:hover {
            background: var(--hover-color);
            transform: translateX(8px);
        }

        .sidebar-section a:focus, .sidebar-section button:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        .login-form, .message-cv {
            display: none;
            padding: 1rem;
            background: #fff;
            color: var(--text-color);
            border-radius: 8px;
            margin-top: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .login-form.active, .message-cv.active {
            display: block;
        }

        .login-form input {
            width: 100%;
            padding: 0.7rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .login-form input:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        .login-form button, .message-cv button {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 0.7rem;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .login-form button:hover, .message-cv button:hover {
            background: var(--hover-color);
        }

        .login-form button:focus, .message-cv button:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        .received-messages {
            margin-top: 1rem;
            padding: 1rem;
            background: #f1f5f9;
            border-radius: 6px;
        }

        .received-messages h4 {
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .message-item {
            padding: 0.8rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .message-item:last-child {
            border-bottom: none;
        }

        .message-item strong {
            color: var(--accent-color);
        }

        .message-item .timestamp {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .cv-container {
            max-width: 1000px;
            margin-left: 280px;
            padding: 2rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            transition: margin-left 0.4s ease;
        }

        .hero-section {
            text-align: center;
            padding: 3rem 0;
            position: relative;
            background: var(--gradient-anim);
            border-radius: 10px;
            overflow: hidden;
            animation: gradientShift 8s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero-section img {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1.5rem;
            border: 4px solid #fff;
            transition: all 0.5s ease;
        }

        .hero-section img:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .hero-section h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .hero-section p {
            font-size: 1.2rem;
            color: #f3f4f6;
            margin-bottom: 1.5rem;
        }

        .lang-btns {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .lang-btn {
            background: #fff;
            color: var(--primary-color);
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            background: var(--accent-color);
            color: #fff;
        }

        .lang-btn:hover {
            background: var(--hover-color);
            color: #fff;
            transform: translateY(-2px);
        }

        .lang-btn:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        .contact-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .contact-info a {
            color: #fff;
            text-decoration: none;
            padding: 0.7rem 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .contact-info a:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
        }

        .contact-info a:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        .section {
            margin: 2rem 0;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.5s ease;
        }

        .section-title:hover {
            color: var(--accent-color);
        }

        .section-title i:hover {
            transform: rotate(360deg);
            transition: transform 0.5s ease;
        }

        .section-title.in-view {
            color: var(--accent-color);
        }

        .section-content {
            display: none;
            padding: 1rem 0;
            font-size: 1rem;
            color: #4b5563;
        }

        details[open] .section-content {
            display: block;
        }

        summary {
            cursor: pointer;
            padding: 0.8rem;
            background: #f1f5f9;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        summary:hover {
            background: var(--accent-color);
            color: #fff;
        }

        summary:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        .tasks-list {
            list-style: none;
            padding-left: 1rem;
        }

        .tasks-list li {
            margin-bottom: 0.6rem;
            font-size: 0.95rem;
            position: relative;
            padding-left: 1.5rem;
        }

        .tasks-list li::before {
            content: "•";
            color: var(--accent-color);
            position: absolute;
            left: 0;
        }

        .toggle-btn, .download-btn, .print-btn, .submit-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover, .download-btn:hover, .print-btn:hover, .submit-btn:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .toggle-btn:focus, .download-btn:focus, .print-btn:focus, .submit-btn:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        .contact-form input, .contact-form textarea {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .contact-form input:focus, .contact-form textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 8px rgba(249, 115, 22, 0.3);
            outline: none;
        }

        .contact-form input:invalid:not(:placeholder-shown), .contact-form textarea:invalid:not(:placeholder-shown) {
            border-color: #ef4444;
        }

        .contact-form input:valid:not(:placeholder-shown) {
            border-color: #10b981;
        }

        .contact-form .input-error {
            color: #ef4444;
            font-size: 0.8rem;
            margin-top: -0.8rem;
            margin-bottom: 1rem;
            display: none;
        }

        .contact-form .input-error.active {
            display: block;
        }

        .contact-form textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-success {
            display: none;
            text-align: center;
            padding: 0.8rem;
            background: #dcfce7;
            color: #166534;
            border-radius: 6px;
            margin-top: 1rem;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 1rem;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .loader i {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .lean-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .lean-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            opacity: 0.6;
            animation: floatParticle 8s infinite ease-in-out;
        }

        @keyframes floatParticle {
            0%, 100% { transform: translateY(0); opacity: 0.6; }
            50% { transform: translateY(-30px); opacity: 0.9; }
        }

        .chart-container {
            max-width: 600px;
            margin: 1rem auto;
        }

        @media screen and (max-width: 1024px) {
            .cv-container {
                margin-left: 220px;
                padding: 1.5rem;
            }
            .sidebar {
                width: 220px;
            }
        }

        @media screen and (max-width: 768px) {
            .cv-container {
                margin-left: 0;
                padding: 1rem;
            }
            .sidebar {
                width: 100%;
                max-width: 280px;
            }
            .hero-section h1 {
                font-size: 2.2rem;
            }
            .hero-section img {
                width: 140px;
                height: 140px;
            }
            .chart-container {
                max-width: 100%;
            }
        }

        @media screen and (max-width: 480px) {
            .hero-section h1 {
                font-size: 1.8rem;
            }
            .hero-section p {
                font-size: 1rem;
            }
            .lang-btn, .contact-info a, .toggle-btn, .download-btn, .print-btn, .submit-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }
        }

        @media print {
            body {
                background: #fff;
                color: #000;
            }
            .sidebar, .lean-elements, .sidebar-toggle, .lang-btns, .download-btn, .print-btn, .submit-btn, .contact-form, .form-success, .loader, .chart-container {
                display: none;
            }
            .cv-container {
                margin-left: 0;
                box-shadow: none;
                padding: 1rem;
            }
            .hero-section {
                background: none;
                border: none;
            }
            .section-content {
                display: block;
            }
            .section-title {
                color: #000;
            }
        }
    </style>
</head>
<body lang="en">
    <div class="lean-elements"></div>
    <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle Sidebar" aria-expanded="false">☰</button>
    <div class="sidebar closed">
        <div class="sidebar-section">
            <h3 data-key="navigation_title">Navigation</h3>
            <button onclick="showMessageCv()" data-key="message_cv" aria-label="View Message CV">Message CV</button>
            <a href="#contact-us" onclick="showContactForm()" data-key="contact_us" aria-label="Contact Us">Contact Us</a>
        </div>
        <div class="login-form" id="login-form">
            <h3 data-key="login_title">Login</h3>
            <input type="email" id="login-email" placeholder="Email" required data-key="login_email_placeholder" aria-label="Email">
            <input type="password" id="login-password" placeholder="Password" required data-key="login_password_placeholder" aria-label="Password">
            <button onclick="loginWithEmail()" data-key="login_button" aria-label="Login">Login</button>
            <button onclick="logout()" data-key="logout_button" aria-label="Logout">Logout</button>
            <div class="loader" id="login-loader">
                <i class="fas fa-spinner fa-spin"></i> <span data-key="loading">Loading...</span>
            </div>
        </div>
        <div class="message-cv" id="message-cv">
            <h3 data-key="message_cv_title">Message CV</h3>
            <button onclick="logout()" data-key="logout_button" aria-label="Logout">Logout</button>
            <div class="received-messages" id="received-messages">
                <h4 data-key="received_messages_title">Received Messages</h4>
                <div class="loader" id="messages-loader">
                    <i class="fas fa-spinner fa-spin"></i> <span data-key="loading">Loading...</span>
                </div>
                <div id="messages-list"></div>
            </div>
        </div>
    </div>
    <div class="cv-container">
        <div class="hero-section">
            <img src="https://i.ibb.co/tgnKQzc/20230728-121604.png" alt="Trabelsi Houssine Profile Picture" onerror="this.src='https://via.placeholder.com/160'">
            <h1 data-key="name">Trabelsi Houssine</h1>
            <p data-key="title">Technician in Injection Molding & Lean Manufacturing</p>
            <div class="lang-btns">
                <button class="lang-btn active" data-lang="en" aria-label="Switch to English" role="button" tabindex="0" data-key="lang_en">English</button>
                <button class="lang-btn" data-lang="fr" aria-label="Switch to French" role="button" tabindex="0" data-key="lang_fr">Français</button>
                <button class="lang-btn" data-lang="ar" aria-label="Switch to Arabic" role="button" tabindex="0" data-key="lang_ar">العربية</button>
            </div>
            <div class="contact-info">
                <a href="tel:+21622310333" aria-label="Phone Number">+216 22 310 333</a>
                <a href="mailto:houssinetrabelsi6@gmail.com" aria-label="Email">houssinetrabelsi6@gmail.com</a>
                <a href="https://www.linkedin.com/in/trabelsi-houssine-355332102" target="_blank" aria-label="LinkedIn Profile">LinkedIn</a>
                <a href="https://www.linkedin.com/in/trabelsi-houssine-355332102" target="_blank" data-key="linkedin_message" aria-label="Message on LinkedIn">Message on LinkedIn</a>
            </div>
            <div class="actions">
                <button class="download-btn" data-key="download" aria-label="Generate and Download CV as PDF">Download CV</button>
                <button class="print-btn" data-key="print" aria-label="Print CV">Print CV</button>
            </div>
        </div>

        <div class="section">
            <details>
                <summary class="section-title"><i class="fas fa-user"></i> <span data-key="summary_title">Summary</span></summary>
                <div class="section-content" data-key="summary_text">
                    Born: September 11, 1990, Bizerte, Tunisia<br>
                    Position: Team Leader Technician (Injection Molding)<br><br>
                    With over 14 years of experience at WKW Tunisia, I am a seasoned professional in injection molding, specializing in the production of high-quality automotive parts. As a Team Leader Technician, I have honed expertise in operating and optimizing advanced injection molding presses, including Engel, Demag Billion, and HUARONG, ensuring precision and efficiency in manufacturing processes.<br><br>
                    My leadership is grounded in Lean Manufacturing principles, with a strong focus on 5S, Kaizen, Gemba, and on-the-job training, driving operational excellence and team performance. I have a proven track record in continuous improvement, achieving an exceptional 99.9% Parts Per Million (PPM) quality rate. Certified in Sepro Robotics and Industrial Safety, I prioritize automation, safety, and quality in all operations.<br><br>
                    <strong>Key Strengths:</strong><br>
                    - Expert in injection molding for automotive components<br>
                    - Proficient in Engel, Demag Billion, and HUARONG press operations<br>
                    - Lean Manufacturing implementation (5S, Kaizen, Gemba)<br>
                    - Continuous improvement with a 99.9% PPM quality achievement<br>
                    - Certified in Sepro Robotics and Industrial Safety
                </div>
            </details>
        </div>

        <div class="section">
            <details>
                <summary class="section-title"><i class="fas fa-cogs"></i> <span data-key="injection_title">Injection Molding</span></summary>
                <div class="section-content" data-key="injection_text">
                    Mastered Engel, Demag Billion Dixi (150T-500T), and HUARONG presses for multi-component automotive parts. Optimized cycle times by 10% (2023), reduced defects by 15%, ensured IATF 16949:2016 compliance.
                </div>
            </details>
        </div>

        <div class="section">
            <details>
                <summary class="section-title"><i class="fas fa-recycle"></i> <span data-key="lean_title">Lean Manufacturing</span></summary>
                <div class="section-content" data-key="lean_text">
                    Applied 5S and Kaizen to reduce waste by 10%. Completed Lean Manufacturing certification (July 2024).
                </div>
            </details>
        </div>

        <div class="section">
            <details>
                <summary class="section-title"><i class="fas fa-chart-line"></i> <span data-key="continuous_title">Continuous Improvement</span></summary>
                <div class="section-content" data-key="continuous_text">
                    Improved efficiency by 20% via TRS and QRQC. Achieved 99.9% PPM compliance (2022). Proposed 15+ improvement actions yearly.
                    <div class="chart-container">
                        <canvas id="improvement-chart"></canvas>
                    </div>
                </div>
            </details>
        </div>

        <div class="section">
            <details>
                <summary class="section-title"><i class="fas fa-briefcase"></i> <span data-key="experience_title">Professional Experience</span></summary>
                <div class="section-content">
                    <p data-key="experience_text">
                        <strong>WKW Tunisia</strong><br>
                        <em data-key="experience_role">Plastic Injection Adjuster Team Leader</em><br>
                        February 2011 – Present<br>
                        German group certified IATF 16949:2016 & ISO 9001. Specializes in automotive parts manufacturing.
                    </p>
                    <h3 data-key="tasks_title">Main Tasks</h3>
                    <h4 data-key="planning_title">Production Planning</h4>
                    <ul class="tasks-list">
                        <li data-key="task_1">Plan work and supplies to meet production goals</li>
                        <li data-key="task_2">Assign operators and manage replacements</li>
                        <li class="hidden-tasks" data-key="task_3">Adjust plans for technical or safety issues</li>
                        <li class="hidden-tasks" data-key="task_4">Allocate resources based on priorities</li>
                    </ul>
                    <h4 data-key="operations_title">Machine Operations</h4>
                    <ul class="tasks-list">
                        <li data-key="task_5">Start and adjust machines for production</li>
                        <li data-key="task_6">Perform first-level maintenance</li>
                        <li class="hidden-tasks" data-key="task_7">Fix machine faults</li>
                        <li class="hidden-tasks" data-key="task_8">Configure robots</li>
                    </ul>
                    <h4 data-key="management_title">Team Management & Reporting</h4>
                    <ul class="tasks-list">
                        <li data-key="task_13">Escalate alerts to superiors</li>
                        <li data-key="task_14">Report equipment needs</li>
                        <li class="hidden-tasks" data-key="task_15">Adjust parameters for anomalies</li>
                        <li class="hidden-tasks" data-key="task_16">Propose improvements</li>
                    </ul>
                    <h4 data-key="improvement_title">Continuous Improvement Technician</h4>
                    <ul class="tasks-list">
                        <li data-key="task_17">Analyze production processes (time, flow, workstation balancing).</li>
                        <li data-key="task_18">Implement continuous improvement tools (e.g., 5S, Lean).</li>
                        <li data-key="task_19">Draft technical specifications and manufacturing sheets.</li>
                        <li data-key="task_20">Participate in the installation and validation of new equipment.</li>
                        <li data-key="task_21">Train teams on new methods.</li>
                    </ul>
                    <button class="toggle-btn" data-key="show_more">Show More</button>
                </div>
            </details>
        </div>

        <div class="section" id="contact-us">
            <details>
                <summary class="section-title"><i class="fas fa-envelope"></i> <span data-key="contact_title">Contact Me</span></summary>
                <div class="section-content">
                    <form class="contact-form" id="contact-form">
                        <input type="text" name="name" placeholder="Your Name" required data-key="form_name_placeholder" aria-label="Your Name">
                        <input type="email" name="email" placeholder="Your Email" required data-key="form_email_placeholder" aria-label="Your Email">
                        <p class="input-error" id="email-error" data-key="invalid_email">Please enter a valid email address.</p>
                        <textarea name="message" placeholder="Your Message" required data-key="form_message_placeholder" aria-label="Your Message"></textarea>
                        <button type="submit" class="submit-btn" data-key="form_submit" aria-label="Send Message">Send Message</button>
                        <div class="loader" id="form-loader">
                            <i class="fas fa-spinner fa-spin"></i> <span data-key="loading">Loading...</span>
                        </div>
                    </form>
                    <p class="form-success" data-key="form_success">Message sent successfully!</p>
                </div>
            </details>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBWGCl2CSrFc9ca3UH_KX0r36RRZJ9BvGg",
            authDomain: "cv-trabelsi.firebaseapp.com",
            projectId: "cv-trabelsi",
            storageBucket: "cv-trabelsi.firebasestorage.app",
            messagingSenderId: "542763054235",
            appId: "1:542763054235:web:77f87d2085d8201848423e",
            measurementId: "G-H58T1VN17E"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const translations = {
            en: {
                name: "Trabelsi Houssine",
                title: "Technician in Injection Molding & Lean Manufacturing",
                navigation_title: "Navigation",
                message_cv: "Message CV",
                contact_us: "Contact Us",
                login_title: "Login",
                login_email_placeholder: "Email",
                login_password_placeholder: "Password",
                login_button: "Login",
                logout_button: "Logout",
                message_cv_title: "Message CV",
                received_messages_title: "Received Messages",
                loading: "Loading...",
                summary_title: "Summary",
                summary_text: `Born: September 11, 1990, Bizerte, Tunisia<br>
Position: Team Leader Technician (Injection Molding)<br><br>
With over 14 years of experience at WKW Tunisia, I am a seasoned professional in injection molding, specializing in the production of high-quality automotive parts. As a Team Leader Technician, I have honed expertise in operating and optimizing advanced injection molding presses, including Engel, Demag Billion, and HUARONG, ensuring precision and efficiency in manufacturing processes.<br><br>
My leadership is grounded in Lean Manufacturing principles, with a strong focus on 5S, Kaizen, Gemba, and on-the-job training, driving operational excellence and team performance. I have a proven track record in continuous improvement, achieving an exceptional 99.9% Parts Per Million (PPM) quality rate. Certified in Sepro Robotics and Industrial Safety, I prioritize automation, safety, and quality in all operations.<br><br>
<strong>Key Strengths:</strong><br>
- Expert in injection molding for automotive components<br>
- Proficient in Engel, Demag Billion, and HUARONG press operations<br>
- Lean Manufacturing implementation (5S, Kaizen, Gemba)<br>
- Continuous improvement with a 99.9% PPM quality achievement<br>
- Certified in Sepro Robotics and Industrial Safety`,
                injection_title: "Injection Molding",
                injection_text: "Mastered Engel, Demag Billion Dixi (150T-500T), and HUARONG presses for multi-component automotive parts. Optimized cycle times by 10% (2023), reduced defects by 15%, ensured IATF 16949:2016 compliance.",
                lean_title: "Lean Manufacturing",
                lean_text: "Applied 5S and Kaizen to reduce waste by 10%. Completed Lean Manufacturing certification (July 2024).",
                continuous_title: "Continuous Improvement",
                continuous_text: "Improved efficiency by 20% via TRS and QRQC. Achieved 99.9% PPM compliance (2022). Proposed 15+ improvement actions yearly.",
                experience_title: "Professional Experience",
                experience_role: "Plastic Injection Adjuster Team Leader",
                experience_text: "<strong>WKW Tunisia</strong><br><em>Plastic Injection Adjuster Team Leader</em><br>February 2011 – Present<br>German group certified IATF 16949:2016 & ISO 9001. Specializes in automotive parts manufacturing.",
                tasks_title: "Main Tasks",
                planning_title: "Production Planning",
                task_1: "Plan work and supplies to meet production goals",
                task_2: "Assign operators and manage replacements",
                task_3: "Adjust plans for technical or safety issues",
                task_4: "Allocate resources based on priorities",
                operations_title: "Machine Operations",
                task_5: "Start and adjust machines for production",
                task_6: "Perform first-level maintenance",
                task_7: "Fix machine faults",
                task_8: "Configure robots",
                management_title: "Team Management & Reporting",
                task_13: "Escalate alerts to superiors",
                task_14: "Report equipment needs",
                task_15: "Adjust parameters for anomalies",
                task_16: "Propose improvements",
                improvement_title: "Continuous Improvement Technician",
                task_17: "Analyze production processes (time, flow, workstation balancing).",
                task_18: "Implement continuous improvement tools (e.g., 5S, Lean).",
                task_19: "Draft technical specifications and manufacturing sheets.",
                task_20: "Participate in the installation and validation of new equipment.",
                task_21: "Train teams on new methods.",
                show_more: "Show More",
                show_less: "Show Less",
                contact_title: "Contact Me",
                form_name_placeholder: "Your Name",
                form_email_placeholder: "Your Email",
                form_message_placeholder: "Your Message",
                form_submit: "Send Message",
                sending: "Sending...",
                form_success: "Message sent successfully!",
                download: "Download CV",
                print: "Print CV",
                linkedin_message: "Message on LinkedIn",
                lang_en: "English",
                lang_fr: "Français",
                lang_ar: "العربية",
                logging_in: "Logging in...",
                login_failed: "Login failed: ",
                invalid_credential: "Invalid email or password.",
                too_many_requests: "Too many attempts. Please try again later.",
                logging_out: "Logging out...",
                logout_failed: "Logout failed: ",
                message_sent: "Message sent successfully!",
                message_failed: "Error fetching messages: ",
                login_first: "Please log in first!",
                rate_limit: "Please wait 30 seconds before submitting again.",
                form_error: "Failed to send message: ",
                permission_denied: "Please log in first.",
                logged_out: "Logged out successfully!",
                no_messages: "No messages received yet.",
                invalid_email: "Please enter a valid email address.",
                generating_pdf: "Generating PDF...",
                pdf_error: "Failed to generate PDF: "
            },
            fr: {
                name: "Trabelsi Houssine",
                title: "Technicien en moulage par injection et Lean Manufacturing",
                navigation_title: "Navigation",
                message_cv: "Message CV",
                contact_us: "Contactez-nous",
                login_title: "Connexion",
                login_email_placeholder: "Email",
                login_password_placeholder: "Mot de passe",
                login_button: "Connexion",
                logout_button: "Déconnexion",
                message_cv_title: "Message CV",
                received_messages_title: "Messages reçus",
                loading: "Chargement...",
                summary_title: "Résumé",
                summary_text: `Né le 11 septembre 1990, Bizerte, Tunisie<br>
Position : Chef d'équipe technicien (moulage par injection)<br><br>
Avec plus de 14 ans d'expérience chez WKW Tunisie, je suis un professionnel chevronné en moulage par injection, spécialisé dans la production de pièces automobiles de haute qualité. En tant que Chef d'Équipe Technicien, j'ai perfectionné mon expertise dans l'opération et l'optimisation de presses à injection avancées, incluant Engel, Demag Billion et HUARONG, garantissant précision et efficacité dans les processus de fabrication.<br><br>
Mon leadership repose sur les principes du Lean Manufacturing, avec un accent particulier sur le 5S, Kaizen, Gemba et la formation sur le terrain, favorisant l'excellence opérationnelle et la performance d'équipe. J'ai un historique prouvé d'amélioration continue, atteignant un taux de qualité exceptionnel de 99,9 % PPM. Certifié en robotique Sepro et en sécurité industrielle, je privilégie l'automatisation, la sécurité et la qualité dans toutes les opérations.<br><br>
<strong>Points forts :</strong><br>
- Expert en moulage par injection pour les composants automobiles<br>
- Maîtrise des opérations de presses Engel, Demag Billion et HUARONG<br>
- Mise en œuvre du Lean Manufacturing (5S, Kaizen, Gemba)<br>
- Amélioration continue avec un taux de qualité PPM de 99,9 %<br>
- Certifié en robotique Sepro et en sécurité industrielle`,
                injection_title: "Moulage par injection",
                injection_text: "Maîtrise des presses Engel, Demag Billion Dixi (150T-500T) et HUARONG pour les pièces automobiles multicomposants. Optimisation des temps de cycle de 10% (2023), réduction des défauts de 15%, conformité à la norme IATF 16949:2016.",
                lean_title: "Lean Manufacturing",
                lean_text: "Application de 5S et Kaizen pour réduire les déchets de 10%. Certification Lean Manufacturing obtenue (juillet 2024).",
                continuous_title: "Amélioration continue",
                continuous_text: "Amélioration de l'efficacité de 20% via TRS et QRQC. Conformité PPM de 99,9% atteinte (2022). Proposition de plus de 15 actions d'amélioration par an.",
                experience_title: "Expérience professionnelle",
                experience_role: "Chef d'équipe ajusteur en injection plastique",
                experience_text: "<strong>WKW Tunisie</strong><br><em>Chef d'équipe ajusteur en injection plastique</em><br>Février 2011 – Présent<br>Groupe allemand certifié IATF 16949:2016 & ISO 9001. Spécialisé dans la fabrication de pièces automobiles.",
                tasks_title: "Tâches principales",
                planning_title: "Planification de la production",
                task_1: "Planifier le travail et les fournitures pour atteindre les objectifs de production",
                task_2: "Assigner les opérateurs et gérer les remplacements",
                task_3: "Ajuster les plans pour les problèmes techniques ou de sécurité",
                task_4: "Allouer les ressources en fonction des priorités",
                operations_title: "Opérations des machines",
                task_5: "Démarrer et ajuster les machines pour la production",
                task_6: "Effectuer la maintenance de premier niveau",
                task_7: "Réparer les pannes des machines",
                task_8: "Configurer les robots",
                management_title: "Gestion d'équipe et rapports",
                task_13: "Escalader les alertes aux supérieurs",
                task_14: "Rapporter les besoins en équipement",
                task_15: "Ajuster les paramètres pour les anomalies",
                task_16: "Proposer des améliorations",
                improvement_title: "Technicien d'amélioration continue",
                task_17: "Analyser les processus de production (temps, flux, équilibrage des postes).",
                task_18: "Mettre en place des outils d’amélioration continue (ex. : 5S, Lean).",
                task_19: "Rédiger des cahiers des charges techniques et des fiches de fabrication.",
                task_20: "Participer à l’installation et à la validation de nouveaux équipements.",
                task_21: "Former les équipes aux nouvelles méthodes.",
                show_more: "Voir plus",
                show_less: "Voir moins",
                contact_title: "Contactez-moi",
                form_name_placeholder: "Votre nom",
                form_email_placeholder: "Votre email",
                form_message_placeholder: "Votre message",
                form_submit: "Envoyer le message",
                sending: "Envoi en cours...",
                form_success: "Message envoyé avec succès !",
                download: "Télécharger le CV",
                print: "Print CV",
                linkedin_message: "Message sur LinkedIn",
                lang_en: "English",
                lang_fr: "Français",
                lang_ar: "العربية",
                logging_in: "Connexion en cours...",
                login_failed: "Échec de la connexion : ",
                invalid_credential: "Email ou mot de passe invalide.",
                too_many_requests: "Trop de tentatives. Veuillez réessayer plus tard.",
                logging_out: "Déconnexion en cours...",
                logout_failed: "Échec de la déconnexion : ",
                message_sent: "Message envoyé avec succès !",
                message_failed: "Erreur lors de l'envoi du message : ",
                login_first: "Veuillez d'abord vous connecter !",
                rate_limit: "Veuillez attendre 30 secondes avant de soumettre à nouveau.",
                form_error: "Échec de l'envoi du message : ",
                permission_denied: "Veuillez d'abord vous connecter.",
                logged_out: "Déconnexion réussie !",
                no_messages: "Aucun message reçu pour le moment.",
                invalid_email: "Veuillez entrer une adresse email valide.",
                generating_pdf: "Génération du PDF...",
                pdf_error: "Échec de la génération du PDF : "
            },
            ar: {
                name: "ترابلسي حسين",
                title: "خبير في القولبة بالحقن والتصنيع الرشيق",
                navigation_title: "التنقل",
                message_cv: "رسالة السيرة الذاتية",
                contact_us: "اتصل بنا",
                login_title: "تسجيل الدخول",
                login_email_placeholder: "البريد الإلكتروني",
                login_password_placeholder: "كلمة المرور",
                login_button: "تسجيل الدخول",
                logout_button: "تسجيل الخروج",
                message_cv_title: "رسالة السيرة الذاتية",
                received_messages_title: "الرسائل المستلمة",
                loading: "جاري التحميل...",
                summary_title: "ملخص",
                summary_text: `مواليد 11 سبتمبر 1990، بنزرت، تونس<br>
المنصب: قائد فريق تقني (القولبة بالحقن)<br><br>
مع أكثر من 14 عامًا من الخبرة في WKW تونس، أنا محترف متمرس في القولبة بالحقن، متخصص في إنتاج قطع غيار السيارات عالية الجودة. كرئيس فريق تقني، قمت بصقل خبرتي في تشغيل وتحسين مكابس القولبة بالحقن المتقدمة، بما في ذلك Engel وDemag Billion وHUARONG، مما يضمن الدقة والكفاءة في عمليات التصنيع.<br><br>
قيادتي تستند إلى مبادئ التصنيع الرشيق، مع التركيز بشكل خاص على 5S، Kaizen، Gemba، والتدريب أثناء العمل، مما يعزز التميز التشغيلي وأداء الفريق. لدي سجل حافل بالتحسين المستمر، محققًا معدل جودة استثنائي بنسبة 99.9% PPM. حاصل على شهادة في روبوتات Sepro والسلامة الصناعية، أعطي الأولوية للأتمتة، السلامة، والجودة في جميع العمليات.<br><br>
<strong>النقاط القوية:</strong><br>
- الخبرة في القولبة بالحقن لمكونات السيارات<br>
- الكفاءة في تشغيل مكابس Engel وDemag Billion وHUARONG<br>
- تطبيق التصنيع الرشيق (5S، Kaizen، Gemba)<br>
- التحسين المستمر مع تحقيق جودة PPM بنسبة 99.9%<br>
- حاصل على شهادة في روبوتات Sepro والسلامة الصناعية`,
                injection_title: "القولبة بالحقن",
                injection_text: "إتقان مكابس Engel وDemag Billion Dixi (150T-500T) وHUARONG لقطع السيارات متعددة المكونات. تحسين أوقات الدورة بنسبة 10% (2023)، تقليل العيوب بنسبة 15%، ضمان الامتثال لمعيار IATF 16949:2016.",
                lean_title: "التصنيع الرشيق",
                lean_text: "تطبيق 5S وKaizen لتقليل النفايات بنسبة 10%. حصلت على شهادة التصنيع الرشيق (يوليو 2024).",
                continuous_title: "التحسين المستمر",
                continuous_text: "تحسين الكفاءة بنسبة 20% عبر TRS وQRQC. تحقيق امتثال PPM بنسبة 99.9% (2022). اقتراح أكثر من 15 إجراء تحسين سنويًا.",
                experience_title: "الخبرة المهنية",
                experience_role: "قائد فريق ضبط القولبة البلاستيكية",
                experience_text: "<strong>WKW تونس</strong><br><em>قائد فريق ضبط القولبة البلاستيكية</em><br>فبراير 2011 – الحاضر<br>مجموعة ألمانية معتمدة بمعايير IATF 16949:2016 وISO 9001. متخصصة في تصنيع قطع غيار السيارات.",
                tasks_title: "المهام الرئيسية",
                planning_title: "تخطيط الإنتاج",
                task_1: "تخطيط العمل والإمدادات لتحقيق أهداف الإنتاج",
                task_2: "تخصيص المشغلين وإدارة البدائل",
                task_3: "تعديل الخطط للمشكلات الفنية أو الأمان",
                task_4: "تخصيص الموارد بناءً على الأولويات",
                operations_title: "تشغيل الآلات",
                task_5: "بدء وتعديل الآلات للإنتاج",
                task_6: "إجراء الصيانة من المستوى الأول",
                task_7: "إصلاح أعطال الآلات",
                task_8: "تهيئة الروبوتات",
                management_title: "إدارة الفريق والتقارير",
                task_13: "تصعيد التنبيهات إلى الرؤساء",
                task_14: "الإبلاغ عن احتياجات المعدات",
                task_15: "تعديل المعلمات للشذوذ",
                task_16: "اقتراح تحسينات",
                improvement_title: "فني التحسين المستمر",
                task_17: "تحليل عمليات الإنتاج (الوقت، التدفق، موازنة المحطات).",
                task_18: "تنفيذ أدوات التحسين المستمر (مثل: 5S، Lean).",
                task_19: "صياغة المواصفات الفنية وأوراق التصنيع.",
                task_20: "المشاركة في تركيب والتحقق من صحة المعدات الجديدة.",
                task_21: "تدريب الفرق على الأساليب الجديدة.",
                show_more: "عرض المزيد",
                show_less: "عرض أقل",
                contact_title: "اتصل بي",
                form_name_placeholder: "اسمك",
                form_email_placeholder: "بريدك الإلكتروني",
                form_message_placeholder: "رسالتك",
                form_submit: "إرسال الرسالة",
                sending: "جاري الإرسال...",
                form_success: "تم إرسال الرسالة بنجاح!",
                download: "تحميل السيرة الذاتية",
                print: "طباعة السيرة الذاتية",
                linkedin_message: "رسالة على LinkedIn",
                lang_en: "English",
                lang_fr: "Français",
                lang_ar: "العربية",
                logging_in: "جاري تسجيل الدخول...",
                login_failed: "فشل تسجيل الدخول: ",
                invalid_credential: "البريد الإلكتروني أو كلمة المرور غير صحيحة.",
                too_many_requests: "محاولات كثيرة جدًا. يرجى المحاولة مرة أخرى لاحقًا.",
                logging_out: "جاري تسجيل الخروج...",
                logout_failed: "فشل تسجيل الخروج: ",
                message_sent: "تم إرسال الرسالة بنجاح!",
                message_failed: "خطأ في إرسال الرسالة: ",
                login_first: "يرجى تسجيل الدخول أولاً!",
                rate_limit: "يرجى الانتظار 30 ثانية قبل الإرسال مرة أخرى.",
                form_error: "فشل إرسال الرسالة: ",
                permission_denied: "يرجى تسجيل الدخول أولاً.",
                logged_out: "تم تسجيل الخروج بنجاح!",
                no_messages: "لا توجد رسائل مستلمة بعد.",
                invalid_email: "يرجى إدخال عنوان بريد إلكتروني صالح.",
                generating_pdf: "جاري إنشاء PDF...",
                pdf_error: "فشل إنشاء PDF: "
            }
        };

        window.toggleSidebar = () => {
            const sidebar = document.querySelector('.sidebar');
            const toggle = document.querySelector('.sidebar-toggle');
            const cvContainer = document.querySelector('.cv-container');
            if (!sidebar || !toggle) return;
            const isClosed = sidebar.classList.contains('closed');
            sidebar.classList.toggle('closed', !isClosed);
            toggle.setAttribute('aria-expanded', isClosed);
            if (cvContainer && window.innerWidth > 768) {
                cvContainer.style.marginLeft = isClosed ? '280px' : '0';
            }
            localStorage.setItem('sidebarState', isClosed ? 'open' : 'closed');
            gsap.to(sidebar, { x: isClosed ? 0 : '-100%', duration: 0.4, ease: "power2.out" });
            if (isClosed) {
                sidebar.querySelector('button, a')?.focus();
            } else {
                toggle.focus();
            }
        };

        window.showLogin = () => {
            const loginForm = document.getElementById('login-form');
            const messageCv = document.getElementById('message-cv');
            if (loginForm && messageCv) {
                loginForm.classList.add('active');
                messageCv.classList.remove('active');
                gsap.fromTo(loginForm, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 });
                loginForm.querySelector('input')?.focus();
            }
        };

        window.showMessageCv = async () => {
            const loginForm = document.getElementById('login-form');
            const messageCv = document.getElementById('message-cv');
            const messagesLoader = document.getElementById('messages-loader');
            if (!loginForm || !messageCv || !messagesLoader) return;
            if (auth.currentUser) {
                loginForm.classList.remove('active');
                messageCv.classList.add('active');
                gsap.fromTo(messageCv, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 });
                messagesLoader.style.display = 'block';
                await fetchReceivedMessages();
                messagesLoader.style.display = 'none';
                messageCv.querySelector('button')?.focus();
            } else {
                alert(translations[currentLang]?.login_first || 'Please log in first!');
                showLogin();
            }
        };

        async function fetchReceivedMessages() {
            const messagesList = document.getElementById('messages-list');
            if (!messagesList) return;
            messagesList.innerHTML = '';
            try {
                const q = query(collection(db, 'contact_messages'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) {
                    messagesList.innerHTML = `<p>${translations[currentLang]?.no_messages || 'No messages received yet.'}</p>`;
                    return;
                }
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const messageItem = document.createElement('div');
                    messageItem.className = 'message-item';
                    messageItem.innerHTML = `
                        <strong>${data.name}</strong>
                        <p>${data.email}</p>
                        <p>${data.message}</p>
                        <p class="timestamp">${new Date(data.timestamp.toDate()).toLocaleString()}</p>
                    `;
                    messagesList.appendChild(messageItem);
                    gsap.from(messageItem, { opacity: 0, y: 10, duration: 0.5, delay: 0.2 });
                });
            } catch (error) {
                messagesList.innerHTML = `<p>${translations[currentLang]?.message_failed || 'Error fetching messages: '} ${error.message}</p>`;
            }
        }

        window.showContactForm = () => {
            const contactSection = document.querySelector('#contact-us');
            if (contactSection) {
                contactSection.querySelector('details').open = true;
                contactSection.scrollIntoView({ behavior: 'smooth' });
                gsap.from(contactSection.querySelector('.section-content'), { opacity: 0, y: 20, duration: 0.5 });
                contactSection.querySelector('input[name="name"]')?.focus();
            }
        };

        window.loginWithEmail = async () => {
            const email = document.getElementById('login-email')?.value;
            const password = document.getElementById('login-password')?.value;
            const loginButton = document.querySelector('#login-form button[data-key="login_button"]');
            const loginLoader = document.getElementById('login-loader');
            if (!loginButton || !email || !password || !loginLoader) {
                alert(translations[currentLang]?.login_failed || 'Login failed: Form elements missing or inputs empty.');
                return;
            }
            loginButton.disabled = true;
            loginButton.textContent = translations[currentLang]?.logging_in || 'Logging in...';
            loginLoader.style.display = 'block';
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                alert((translations[currentLang]?.logged_in || 'Logged in successfully as ') + userCredential.user.email + '!');
                showMessageCv();
            } catch (error) {
                let errorMessage = translations[currentLang]?.login_failed || 'Login failed: ';
                if (error.code === 'auth/invalid-credential') {
                    errorMessage += translations[currentLang]?.invalid_credential || 'Invalid email or password.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage += translations[currentLang]?.too_many_requests || 'Too many attempts. Please try again later.';
                } else {
                    errorMessage += error.message;
                }
                alert(errorMessage);
            } finally {
                loginButton.disabled = false;
                loginButton.textContent = translations[currentLang]?.login_button || 'Login';
                loginLoader.style.display = 'none';
            }
        };

        window.logout = async () => {
            const logoutButtons = document.querySelectorAll('button[data-key="logout_button"]');
            if (!logoutButtons.length) return;
            logoutButtons.forEach(button => {
                button.disabled = true;
                button.textContent = translations[currentLang]?.logging_out || 'Logging out...';
            });
            try {
                await signOut(auth);
                alert(translations[currentLang]?.logged_out || 'Logged out successfully!');
                showLogin();
            } catch (error) {
                alert((translations[currentLang]?.logout_failed || 'Logout failed: ') + error.message);
            } finally {
                logoutButtons.forEach(button => {
                    button.disabled = false;
                    button.textContent = translations[currentLang]?.logout_button || 'Logout';
                });
            }
        };

        let lastSubmission = 0;
        const contactForm = document.getElementById('contact-form');
        if (contactForm) {
            const emailInput = document.querySelector('#contact-form [name="email"]');
            const emailError = document.getElementById('email-error');
            if (emailInput && emailError) {
                emailInput.addEventListener('input', () => {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailInput.value || emailRegex.test(emailInput.value)) {
                        emailError.classList.remove('active');
                    } else {
                        emailError.classList.add('active');
                    }
                });
            }
            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const now = Date.now();
                if (now - lastSubmission < 30000) {
                    alert(translations[currentLang]?.rate_limit || 'Please wait 30 seconds before submitting again.');
                    return;
                }
                lastSubmission = now;
                const name = document.querySelector('#contact-form [name="name"]')?.value;
                const email = document.querySelector('#contact-form [name="email"]')?.value;
                const message = document.querySelector('#contact-form [name="message"]')?.value;
                const formSuccess = document.querySelector('.form-success');
                const submitButton = document.querySelector('#contact-form .submit-btn');
                const formLoader = document.getElementById('form-loader');
                if (!name || !email || !message || !formSuccess || !submitButton || !formLoader) {
                    alert(translations[currentLang]?.form_error || 'Failed to send message: Form elements missing or inputs empty.');
                    return;
                }
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert(translations[currentLang]?.invalid_email || 'Please enter a valid email address.');
                    emailError.classList.add('active');
                    emailInput.focus();
                    return;
                }
                submitButton.disabled = true;
                submitButton.textContent = translations[currentLang]?.sending || 'Sending...';
                formLoader.style.display = 'block';
                try {
                    await addDoc(collection(db, "contact_messages"), {
                        name: name,
                        email: email,
                        message: message,
                        timestamp: new Date()
                    });
                    formSuccess.style.display = 'block';
                    contactForm.reset();
                    emailError.classList.remove('active');
                    gsap.fromTo(formSuccess, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.5 });
                    setTimeout(() => {
                        gsap.to(formSuccess, { opacity: 0, duration: 0.5, onComplete: () => formSuccess.style.display = 'none' });
                    }, 3000);
                } catch (error) {
                    alert((translations[currentLang]?.form_error || 'Failed to send message: ') + error.message);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = translations[currentLang]?.form_submit || 'Send Message';
                    formLoader.style.display = 'none';
                }
            });
        }

        const langButtons = document.querySelectorAll('.lang-btn');
        let currentLang = localStorage.getItem('lang') || 'en';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.body.setAttribute('lang', lang);
            langButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
                btn.setAttribute('aria-current', btn.dataset.lang === lang ? 'true' : 'false');
            });
            document.querySelectorAll('[data-key]').forEach(element => {
                const translation = translations[lang][element.dataset.key] || element.innerHTML;
                element.innerHTML = translation;
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.placeholder = translations[lang][element.dataset.key] || element.placeholder;
                }
            });
            if (auth.currentUser && document.getElementById('message-cv')?.classList.contains('active')) {
                fetchReceivedMessages();
            }
            initChart();
        }

        langButtons.forEach(btn => btn.addEventListener('click', () => {
            setLanguage(btn.dataset.lang);
            gsap.from('.cv-container', { opacity: 0, duration: 0.5 });
            btn.focus();
        }));
        setLanguage(currentLang);

        document.querySelectorAll('details').forEach(details => {
            details.addEventListener('toggle', () => {
                if (details.open) {
                    document.querySelectorAll('details').forEach(other => {
                        if (other !== details) other.removeAttribute('open');
                    });
                    gsap.from(details.querySelector('.section-content'), { opacity: 0, y: 20, duration: 0.5 });
                    details.querySelector('summary')?.focus();
                }
            });
        });

        const toggleBtn = document.querySelector('.toggle-btn');
        if (toggleBtn) {
            toggleBtn.addEventListener('click', () => {
                const hiddenTasks = document.querySelectorAll('.hidden-tasks');
                const isHidden = hiddenTasks[0]?.style.display === 'none' || !hiddenTasks[0]?.style.display;
                hiddenTasks.forEach(task => task.style.display = isHidden ? 'list-item' : 'none');
                toggleBtn.textContent = translations[currentLang][isHidden ? 'show_less' : 'show_more'];
                gsap.from(hiddenTasks, { opacity: 0, y: 10, duration: 0.5, stagger: 0.1 });
                toggleBtn.focus();
            });
        }

        const printBtn = document.querySelector('.print-btn');
        if (printBtn) {
            printBtn.addEventListener('click', () => window.print());
        }

        const downloadBtn = document.querySelector('.download-btn');
        if (downloadBtn) {
            downloadBtn.addEventListener('click', async () => {
                downloadBtn.disabled = true;
                downloadBtn.textContent = translations[currentLang]?.generating_pdf || 'Generating PDF...';
                try {
                    const element = document.querySelector('.cv-container');
                    if (!element) throw new Error('CV container not found');
                    const sidebar = document.querySelector('.sidebar');
                    const toggle = document.querySelector('.sidebar-toggle');
                    const langButtons = document.querySelector('.lang-btns');
                    const buttons = document.querySelector('.actions');
                    const contactForm = document.querySelector('#contact-us');
                    const chart = document.querySelector('.chart-container');
                    if (sidebar) sidebar.style.display = 'none';
                    if (toggle) toggle.style.display = 'none';
                    if (langButtons) langButtons.style.display = 'none';
                    if (buttons) buttons.style.display = 'none';
                    if (contactForm) contactForm.style.display = 'none';
                    if (chart) chart.style.display = 'none';
                    document.querySelectorAll('.section-content').forEach(content => content.style.display = 'block');
                    await html2pdf().from(element).set({
                        filename: 'Trabelsi_Houssine_CV.pdf',
                        margin: 10,
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                    }).save();
                } catch (error) {
                    alert((translations[currentLang]?.pdf_error || 'Failed to generate PDF: ') + error.message);
                } finally {
                    downloadBtn.disabled = false;
                    downloadBtn.textContent = translations[currentLang]?.download || 'Download CV';
                    const sidebar = document.querySelector('.sidebar');
                    const toggle = document.querySelector('.sidebar-toggle');
                    const langButtons = document.querySelector('.lang-btns');
                    const buttons = document.querySelector('.actions');
                    const contactForm = document.querySelector('#contact-us');
                    const chart = document.querySelector('.chart-container');
                    if (sidebar) sidebar.style.display = 'block';
                    if (toggle) toggle.style.display = 'block';
                    if (langButtons) langButtons.style.display = 'flex';
                    if (buttons) buttons.style.display = 'block';
                    if (contactForm) contactForm.style.display = 'block';
                    if (chart) chart.style.display = 'block';
                    document.querySelectorAll('.section-content').forEach(content => content.style.display = 'none');
                    downloadBtn.focus();
                }
            });
        }

        function createLeanElements() {
            const leanContainer = document.querySelector('.lean-elements');
            if (!leanContainer) return;
            for (let i = 0; i < 5; i++) {
                const particle = document.createElement('div');
                particle.className = 'lean-particle';
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                particle.style.animationDelay = `${Math.random() * 3}s`;
                leanContainer.appendChild(particle);
            }
        }

        function initChart() {
            const ctx = document.getElementById('improvement-chart')?.getContext('2d');
            if (!ctx) return;
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        translations[currentLang]?.cycle_time || 'Cycle Time Optimization',
                        translations[currentLang]?.defect_reduction || 'Defect Reduction',
                        translations[currentLang]?.efficiency || 'Efficiency Improvement'
                    ],
                    datasets: [{
                        label: translations[currentLang]?.improvement_label || 'Improvement (%)',
                        data: [10, 15, 20],
                        backgroundColor: ['#f97316', '#f59e0b', '#1e3a8a'],
                        borderColor: ['#fff', '#fff', '#fff'],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: translations[currentLang]?.percentage || 'Percentage (%)' }
                        },
                        x: {
                            title: { display: true, text: translations[currentLang]?.metrics || 'Metrics' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: translations[currentLang]?.chart_title || 'Continuous Improvement Metrics' }
                    },
                    animation: {
                        onComplete: () => {
                            gsap.from('#improvement-chart', { opacity: 0, y: 20, duration: 0.8 });
                        }
                    }
                }
            });
        }

        function initSectionAnimations() {
            document.querySelectorAll('.section').forEach(section => {
                const observer = new IntersectionObserver(entries => {
                    entries.forEach(entry => {
                        const title = entry.target.querySelector('.section-title');
                        if (entry.isIntersecting) {
                            title.classList.add('in-view');
                            gsap.to(title, { color: 'var(--accent-color)', duration: 0.5 });
                        } else {
                            title.classList.remove('in-view');
                            gsap.to(title, { color: 'var(--primary-color)', duration: 0.5 });
                        }
                    });
                }, { threshold: 0.5 });
                observer.observe(section);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            createLeanElements();
            initChart();
            initSectionAnimations();
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    showMessageCv();
                } else {
                    showLogin();
                }
            });
            const sidebarState = localStorage.getItem('sidebarState') || 'closed';
            if (sidebarState === 'open' && window.innerWidth > 768) {
                toggleSidebar();
            }
            gsap.from('.hero-section', { opacity: 0, scale: 0.9, duration: 1, ease: "power3.out" });
            gsap.from('.hero-section img', { opacity: 0, y: -50, duration: 0.8, delay: 0.2 });
            gsap.from('.hero-section h1', { opacity: 0, y: 30, duration: 0.8, delay: 0.4 });
            gsap.from('.hero-section p', { opacity: 0, y: 30, duration: 0.8, delay: 0.6 });
            gsap.from('.lang-btns .lang-btn', { opacity: 0, y: 20, duration: 0.6, delay: 0.8, stagger: 0.1 });
            gsap.from('.contact-info a', { opacity: 0, y: 20, duration: 0.6, delay: 1, stagger: 0.1 });
            gsap.from('.actions', { opacity: 0, y: 20, duration: 0.6, delay: 1.2 });
            gsap.from('.section', { opacity: 0, x: -30, duration: 0.8, stagger: 0.2, delay: 1.4 });
        });
    </script>
</body>
</html>
